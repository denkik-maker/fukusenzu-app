<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>複線図シミュレーター</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { touch-action: manipulation; background-color: #f3f4f6; font-family: sans-serif; }
        .canvas-area { position: relative; width: 100%; height: 400px; background: white; border-bottom: 2px solid #e5e7eb; overflow: hidden; }
        .node { cursor: pointer; transition: transform 0.1s; }
        .node:active { transform: scale(1.3); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script>
        // JSXを使わないReactの書き方に変換（真っ白画面を回避する最強の手段）
        const e = React.createElement;
        const { useState, useEffect } = React;

        const App = () => {
            const [lines, setLines] = useState([]);
            const [selection, setSelection] = useState(null);
            const [color, setColor] = useState('black');
            const [thickness, setThickness] = useState(1.6);
            const [message, setMessage] = useState("端子をタップして開始");

            const points = [
                { id: 'p_l', label: '電源 L', x: 50, y: 100 },
                { id: 'p_n', label: '電源 N', x: 50, y: 150 },
                { id: 'lamp', label: 'ランプ', x: 300, y: 80 },
                { id: 'sw', label: 'スイッチ', x: 300, y: 200 },
                { id: 'jb1', label: '', x: 150, y: 100, isJB: true },
                { id: 'jb2', label: '', x: 150, y: 150, isJB: true },
                { id: 'jb3', label: '', x: 200, y: 100, isJB: true },
                { id: 'jb4', label: '', x: 200, y: 150, isJB: true }
            ];

            const handleTap = (id) => {
                if (!selection) {
                    setSelection(id);
                    setMessage("接続先を選んでください");
                } else {
                    if (selection === id) { setSelection(null); return; }
                    setLines([...lines, { from: selection, to: id, color, thickness }]);
                    setSelection(null);
                    setMessage("接続しました！");
                }
            };

            return e('div', { className: 'flex flex-col h-screen' },
                e('header', { className: 'bg-white p-4 shadow-sm font-bold text-center' }, "複線図マスター 公開版"),
                e('div', { className: 'canvas-area' },
                    e('svg', { className: 'w-full h-full' },
                        // ジョイントボックス枠
                        e('rect', { x: 130, y: 70, width: 90, height: 120, fill: 'none', stroke: '#ccc', strokeDasharray: '4' }),
                        // 配線
                        lines.map((l, i) => {
                            const p1 = points.find(p => p.id === l.from);
                            const p2 = points.find(p => p.id === l.to);
                            return e('line', {
                                key: i, x1: p1.x, y1: p1.y, x2: p2.x, y2: p2.y,
                                stroke: l.color, strokeWidth: l.thickness === 2.0 ? 6 : 3, strokeLinecap: 'round'
                            });
                        }),
                        // 端子
                        points.map(p => e('g', { key: p.id, onClick: () => handleTap(p.id), className: 'node' },
                            e('circle', { cx: p.x, cy: p.y, r: 8, fill: selection === p.id ? '#3b82f6' : '#1e293b' }),
                            p.label && e('text', { x: p.x - 20, y: p.y - 15, className: 'text-[10px] font-bold' }, p.label)
                        ))
                    )
                ),
                e('footer', { className: 'bg-white p-6 flex-1' },
                    e('p', { className: 'text-center text-blue-600 font-bold mb-4' }, message),
                    e('div', { className: 'flex justify-between items-center mb-6' },
                        e('div', { className: 'flex gap-2' },
                            ['black', 'red', 'blue'].map(c => e('button', {
                                key: c, onClick: () => setColor(c),
                                className: `w-10 h-10 rounded-full border-4 ${color === c ? 'border-yellow-400' : 'border-transparent'}`,
                                style: { backgroundColor: c }
                            }))
                        ),
                        e('div', { className: 'flex bg-gray-200 p-1 rounded-lg' },
                            [1.6, 2.0].map(t => e('button', {
                                key: t, onClick: () => setThickness(t),
                                className: `px-4 py-2 rounded-md text-sm font-bold ${thickness === t ? 'bg-white shadow' : 'text-gray-500'}`
                            }, t + "mm"))
                        )
                    ),
                    e('button', { 
                        onClick: () => { if(confirm("消去しますか？")) setLines([]); },
                        className: 'w-full bg-red-500 text-white py-4 rounded-xl font-bold'
                    }, "リセット")
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(App));
    </script>
</body>
</html>
